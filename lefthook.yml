# lefthook.yml
# Official git hooks only - custom commands moved to scripts/ and Makefile

# Official git hooks with scripts + Makefile integration
pre-commit:
  parallel: true
  commands:
    # Main pre-commit check using Makefile
    pre-commit-check:
      glob: "*.dart"
      run: make pre-commit
      stage_fixed: true
    # Quick spell check on staged files
    spell-check-quick:
      glob: "*.md"
      run: |
        npx cspell --config cspell.json {staged_files} --no-progress || \
        echo "⚠️ Fix spelling issues"
    # License check when pubspec.yaml changes
    license-check:
      glob: "pubspec.yaml"
      run: |
        if git diff --cached --name-only | grep -q "pubspec.yaml"; then
          echo "📦 pubspec.yaml changed, checking licenses..."
          make license-check
        fi
    # Dependency validation when pubspec.yaml changes
    deps-validation:
      glob: "pubspec.yaml"
      run: |
        if git diff --cached --name-only | grep -q "pubspec.yaml"; then
          echo "📦 pubspec.yaml changed, validating dependencies..."
          make validate-deps
        fi
    # i18n validation when translation files change
    i18n-validation:
      glob: "lib/l10n/i18n/*.json"
      run: |
        if git diff --cached --name-only | grep -q "lib/l10n/i18n/.*\.json"; then
          echo "🌐 Translation files changed, validating i18n..."
          make i18n-validate
        fi

pre-push:
  parallel: false
  commands:
    # Optimize project size before push
    optimize-project:
      run: ./scripts/optimize-for-push.sh
    # Run bash script tests first (TDD validation)
    bash-script-tests:
      run: npm test
    # Quick pre-push checks (optimized for speed)
    quick-checks:
      run: make pre-push-ci
    # Full dependency validation before push
    validate-dependencies:
      run: make validate-deps
    # Complete naming conventions validation
    naming-validation:
      run: make naming-check

commit-msg:
  commands:
    conventional-commit:
      run: |
        if command -v fvm >/dev/null 2>&1; then
          fvm dart run tool/validate_commit.dart {1}
        else
          dart run tool/validate_commit.dart {1}
        fi
